<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">

   <title>Parse command line arguments / Ruby</title>

   <link rel="icon" href="/autumn/favicon.png">
   <link rel="stylesheet" href="/autumn/main.css">
</head>
<body>
   <header class="page">

      <h2><a href="/autumn">Autumn</a></h2>

      <a href="/autumn/categories">Categories</a>
      <a href="/autumn/tags">Tags</a>
      <a href="https://github.com/nu8/autumn">Repository</a>
   </header>
   <main class="page">

<h1>
   <a href="/autumn/parse-command-line-args/">Parse command line arguments</a> / Ruby
</h1>
<section class="page">
   <time>Fri Oct 16 2020</time>
   
   <a href="/autumn/categories/system/">system</a>
   
</section>
   


<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rb" data-lang="rb">require <span style="color:#e6db74">&#39;optparse&#39;</span>

options <span style="color:#f92672">=</span> {}
<span style="color:#66d9ef">OptionParser</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>opts<span style="color:#f92672">|</span>
  opts<span style="color:#f92672">.</span>on(<span style="color:#e6db74">&#39;-i&#39;</span>, <span style="color:#e6db74">&#39;--input PATH&#39;</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>arg<span style="color:#f92672">|</span>
    options<span style="color:#f92672">[</span><span style="color:#e6db74">:input</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> arg
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span><span style="color:#f92672">.</span>parse!

<span style="color:#66d9ef">if</span> options<span style="color:#f92672">[</span><span style="color:#e6db74">:input</span><span style="color:#f92672">].</span>nil?
  f <span style="color:#f92672">=</span> $stdin
<span style="color:#66d9ef">else</span>
  f <span style="color:#f92672">=</span> <span style="color:#66d9ef">File</span><span style="color:#f92672">.</span>open(options<span style="color:#f92672">[</span><span style="color:#e6db74">:input</span><span style="color:#f92672">]</span>)
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">OptionParser</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>opts<span style="color:#f92672">|</span>
  opts<span style="color:#f92672">.</span>banner <span style="color:#f92672">=</span>
    <span style="color:#e6db74">&#34;usage: </span><span style="color:#e6db74">#{</span>$PROGRAM_NAME<span style="color:#e6db74">}</span><span style="color:#e6db74"> [OPTIONS] [ARG ...]&#34;</span>
  opts<span style="color:#f92672">.</span>on(<span style="color:#e6db74">&#39;-i&#39;</span>, <span style="color:#e6db74">&#39;--input PATH&#39;</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>arg<span style="color:#f92672">|</span>
    options<span style="color:#f92672">[</span><span style="color:#e6db74">:input</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> arg
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">if</span> options<span style="color:#f92672">[</span><span style="color:#e6db74">:input</span><span style="color:#f92672">].</span>nil?
    puts opts
    exit <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span><span style="color:#f92672">.</span>parse!

require <span style="color:#e6db74">&#34;getoptlong&#34;</span>
require <span style="color:#e6db74">&#34;rdoc/usage&#34;</span>
 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">phone</span>(name, message)
	puts <span style="color:#e6db74">&#34;Calling </span><span style="color:#e6db74">#{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">...&#34;</span>
	puts message
<span style="color:#66d9ef">end</span>
 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test</span>
	phone(<span style="color:#e6db74">&#34;Barry&#34;</span>, <span style="color:#e6db74">&#34;Hi!&#34;</span>)
	phone(<span style="color:#e6db74">&#34;Cindy&#34;</span>, <span style="color:#e6db74">&#34;Hello!&#34;</span>)
<span style="color:#66d9ef">end</span>
 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>
	mode <span style="color:#f92672">=</span> <span style="color:#e6db74">:usage</span>
 
	name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
	message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
 
	opts<span style="color:#f92672">=</span><span style="color:#66d9ef">GetoptLong</span><span style="color:#f92672">.</span>new(
		<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;--help&#34;</span>, <span style="color:#e6db74">&#34;-h&#34;</span>, <span style="color:#66d9ef">GetoptLong</span><span style="color:#f92672">::</span><span style="color:#66d9ef">NO_ARGUMENT</span><span style="color:#f92672">]</span>,
		<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;--eddy&#34;</span>, <span style="color:#e6db74">&#34;-e&#34;</span>, <span style="color:#66d9ef">GetoptLong</span><span style="color:#f92672">::</span><span style="color:#66d9ef">REQUIRED_ARGUMENT</span><span style="color:#f92672">]</span>,
		<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;--daniel&#34;</span>, <span style="color:#e6db74">&#34;-d&#34;</span>, <span style="color:#66d9ef">GetoptLong</span><span style="color:#f92672">::</span><span style="color:#66d9ef">REQUIRED_ARGUMENT</span><span style="color:#f92672">]</span>,
		<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;--test&#34;</span>, <span style="color:#e6db74">&#34;-t&#34;</span>, <span style="color:#66d9ef">GetoptLong</span><span style="color:#f92672">::</span><span style="color:#66d9ef">NO_ARGUMENT</span><span style="color:#f92672">]</span>
	)
 
	opts<span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>option, value<span style="color:#f92672">|</span>
		<span style="color:#66d9ef">case</span> option
		<span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;--help&#34;</span>
			<span style="color:#66d9ef">RDoc</span><span style="color:#f92672">::</span>usage(<span style="color:#e6db74">&#34;Usage&#34;</span>)
		<span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;--eddy&#34;</span>
			mode <span style="color:#f92672">=</span> <span style="color:#e6db74">:call</span>
			name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;eddy&#34;</span>
			message <span style="color:#f92672">=</span> value
		<span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;--daniel&#34;</span>
			mode <span style="color:#f92672">=</span> <span style="color:#e6db74">:call</span>
			name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;daniel&#34;</span>
			message <span style="color:#f92672">=</span> value
		<span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;--test&#34;</span>
			mode <span style="color:#f92672">=</span> <span style="color:#e6db74">:test</span>
		<span style="color:#66d9ef">end</span>
	}
 
	<span style="color:#66d9ef">case</span> mode
	<span style="color:#66d9ef">when</span> <span style="color:#e6db74">:usage</span>
		<span style="color:#66d9ef">RDoc</span><span style="color:#f92672">::</span>usage(<span style="color:#e6db74">&#34;Usage&#34;</span>)
	<span style="color:#66d9ef">when</span> <span style="color:#e6db74">:call</span>
		phone(name, message)
	<span style="color:#66d9ef">when</span> <span style="color:#e6db74">:test</span>
		test
	<span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
 
<span style="color:#66d9ef">if</span> __FILE__<span style="color:#f92672">==</span>$0
	<span style="color:#66d9ef">begin</span>
		main
	<span style="color:#66d9ef">rescue</span> <span style="color:#66d9ef">Interrupt</span> <span style="color:#f92672">=&gt;</span> e
		<span style="color:#66d9ef">nil</span>
	<span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

require <span style="color:#e6db74">&#39;optparse&#39;</span>
sflag <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
longflag <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
percent <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
fruit <span style="color:#f92672">=</span> <span style="color:#66d9ef">nil</span>
<span style="color:#66d9ef">OptionParser</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>opts<span style="color:#f92672">|</span>
  opts<span style="color:#f92672">.</span>banner <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34; [arguments...]&#34;</span>
  opts<span style="color:#f92672">.</span>separator <span style="color:#e6db74">&#34;This demo prints the results of parsing the options.&#34;</span>
  opts<span style="color:#f92672">.</span>version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0.0.1&#34;</span>
  opts<span style="color:#f92672">.</span>on(<span style="color:#e6db74">&#34;-s&#34;</span>, <span style="color:#e6db74">&#34;Enable short flag&#34;</span>) {sflag <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>}
  opts<span style="color:#f92672">.</span>on(<span style="color:#e6db74">&#34;--long&#34;</span>, <span style="color:#e6db74">&#34;Enable long flag&#34;</span>) {longflag <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>}
  opts<span style="color:#f92672">.</span>on(<span style="color:#e6db74">&#34;-b&#34;</span>, <span style="color:#e6db74">&#34;--both&#34;</span>, <span style="color:#e6db74">&#34;Enable both -s and --long&#34;</span>) {sflag <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>; longflag <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>}
  opts<span style="color:#f92672">.</span>on(<span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;--count&#34;</span>, <span style="color:#e6db74">&#34;Add 1 to count&#34;</span>) {count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>}
  opts<span style="color:#f92672">.</span>on(<span style="color:#e6db74">&#34;-p&#34;</span>, <span style="color:#e6db74">&#34;--percent PERCENT&#34;</span>, <span style="color:#e6db74">/[0-9]+%?/i</span>, <span style="color:#e6db74">&#34;Percent [50%]&#34;</span>) {<span style="color:#f92672">|</span>arg<span style="color:#f92672">|</span> percent <span style="color:#f92672">=</span> arg<span style="color:#f92672">.</span>to_i}
  opts<span style="color:#f92672">.</span>on(<span style="color:#e6db74">&#34;-f&#34;</span>, <span style="color:#e6db74">&#34;--fruit FRUIT&#34;</span>, <span style="color:#f92672">[</span><span style="color:#e6db74">:apple</span>, <span style="color:#e6db74">:banana</span>, <span style="color:#e6db74">:orange</span>, <span style="color:#e6db74">:pear</span><span style="color:#f92672">]</span>, <span style="color:#e6db74">&#34;Fruit (apple, banana, orange, pear)&#34;</span>) {<span style="color:#f92672">|</span>arg<span style="color:#f92672">|</span> fruit <span style="color:#f92672">=</span> arg}
  <span style="color:#66d9ef">begin</span>
    opts<span style="color:#f92672">.</span>parse!
  <span style="color:#66d9ef">rescue</span> <span style="color:#66d9ef">OptionParser</span><span style="color:#f92672">::</span><span style="color:#66d9ef">ParseError</span> <span style="color:#f92672">=&gt;</span> error
    $stderr<span style="color:#f92672">.</span>puts error
    $stderr<span style="color:#f92672">.</span>puts <span style="color:#e6db74">&#34;(-h or --help will show valid options)&#34;</span>
    exit <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
 
print <span style="color:#e6db74">&lt;&lt;EOF
</span><span style="color:#e6db74"></span><span style="color:#66d9ef">Short</span> <span style="color:#e6db74">flag</span>: <span style="color:#75715e">#{sflag}</span>
<span style="color:#66d9ef">Long</span> <span style="color:#e6db74">flag</span>: <span style="color:#75715e">#{longflag}</span>
<span style="color:#e6db74">Count</span>: <span style="color:#75715e">#{count}</span>
<span style="color:#e6db74">Percent</span>: <span style="color:#75715e">#{percent}%</span>
<span style="color:#e6db74">Fruit</span>: <span style="color:#75715e">#{fruit}</span>
<span style="color:#e6db74">Arguments</span>: <span style="color:#75715e">#{ARGV.inspect}</span>
<span style="color:#66d9ef">EOF</span>
</code></pre></div>
<h2 id="references">References</h2>
<ul>
<li><a href="https://hyperpolyglot.org/scripting2#option-parsing">https://hyperpolyglot.org/scripting2#option-parsing</a></li>
<li><a href="https://programming-idioms.org/idiom/162">https://programming-idioms.org/idiom/162</a></li>
<li><a href="https://rosettacode.org/wiki/Parse_command-line_arguments">https://rosettacode.org/wiki/Parse_command-line_arguments</a></li>
</ul>

</main>

</body>
</html>
